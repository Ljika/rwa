<div class="dashboard-container" *ngIf="currentUser$ | async as currentUser">
  <!-- Navbar -->
  <header class="navbar">
    <div class="logo">
      <h2>MediSync - Admin Panel</h2>
    </div>
    <div class="user-info">
      <span>DobrodoÅ¡li, {{ currentUser.firstName }} {{ currentUser.lastName }}</span>
      <button class="btn-logout" (click)="logout()">Odjavi se</button>
    </div>
  </header>

  <!-- Tab Navigation -->
  <nav class="tabs">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'lekovi'" 
      (click)="selectTab('lekovi')">
      ğŸ’Š Lekovi
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'proizvodjaci'" 
      (click)="selectTab('proizvodjaci')">
      ğŸ­ ProizvoÄ‘aÄi
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'profil'" 
      (click)="selectTab('profil')">
      ğŸ‘¤ Profil
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'pacijenti'" 
      (click)="selectTab('pacijenti')">
      ğŸ¥ Pacijenti
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'doktori'" 
      (click)="selectTab('doktori')">
      ğŸ‘¨â€âš•ï¸ Doktori
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'administratori'" 
      (click)="selectTab('administratori')">
      ğŸ‘” Administratori
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'povezi'" 
      (click)="selectTab('povezi')">
      ğŸ”— PoveÅ¾i doktora i pacijenta
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'ukloni'" 
      (click)="selectTab('ukloni')">
      âŒ Ukloni pacijenta doktoru
    </button>
  </nav>

  <!-- Content Area -->
  <div class="content">
    <!-- Lekovi Tab -->
    <div *ngIf="activeTab === 'lekovi'" class="tab-content">
      <app-drugs-admin></app-drugs-admin>
    </div>
    <!-- ProizvoÄ‘aÄi Tab -->
    <div *ngIf="activeTab === 'proizvodjaci'" class="tab-content">
      <app-manufacturers-admin></app-manufacturers-admin>
    </div>
    <!-- Profil Tab -->
    <div *ngIf="activeTab === 'profil'" class="tab-content">
      <div class="profile-header">
        <h3>Moj Profil</h3>
        <button 
          *ngIf="!isEditMode" 
          class="btn-edit" 
          (click)="toggleEditMode()">
          âœï¸ Izmeni Profil
        </button>
      </div>

      <!-- View Mode -->
      <div *ngIf="!isEditMode" class="profile-info">
        <div class="info-section">
          <h5>LiÄni podaci</h5>
          <div class="info-row">
            <span class="label">Ime:</span>
            <span class="value">{{ currentUser.firstName }}</span>
          </div>
          <div class="info-row">
            <span class="label">Prezime:</span>
            <span class="value">{{ currentUser.lastName }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ currentUser.email }}</span>
          </div>
          <div class="info-row">
            <span class="label">Telefon:</span>
            <span class="value">{{ currentUser.phoneNumber || 'Nije uneto' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Datum roÄ‘enja:</span>
            <span class="value">{{ currentUser.dateOfBirth || 'Nije uneto' }}</span>
          </div>
          <div class="info-row">
            <span class="label">Pol:</span>
            <span class="value">{{ currentUser.gender || 'Nije uneto' }}</span>
          </div>
        </div>

        <div class="info-section">
          <h5>Administratorski pristup</h5>
          <div class="info-row">
            <span class="label">Uloga:</span>
            <span class="value admin-role">Administrator</span>
          </div>
        </div>
      </div>

      <!-- Edit Mode -->
      <div *ngIf="isEditMode" class="edit-profile-form">
        <form [formGroup]="editProfileForm" (ngSubmit)="saveProfile()">
          <div class="form-section">
            <h5>LiÄni podaci</h5>
            
            <div class="form-group">
              <label>Ime:</label>
              <input type="text" formControlName="firstName" class="form-control">
              <div class="error" *ngIf="editProfileForm.get('firstName')?.invalid && editProfileForm.get('firstName')?.touched">
                Ime je obavezno
              </div>
            </div>

            <div class="form-group">
              <label>Prezime:</label>
              <input type="text" formControlName="lastName" class="form-control">
              <div class="error" *ngIf="editProfileForm.get('lastName')?.invalid && editProfileForm.get('lastName')?.touched">
                Prezime je obavezno
              </div>
            </div>

            <div class="form-group">
              <label>Telefon:</label>
              <input type="text" formControlName="phoneNumber" class="form-control">
            </div>

            <div class="form-group">
              <label>Datum roÄ‘enja:</label>
              <input type="date" formControlName="dateOfBirth" class="form-control">
            </div>

            <div class="form-group">
              <label>Pol:</label>
              <select formControlName="gender" class="form-control">
                <option value="">Izaberi pol</option>
                <option *ngFor="let gender of genders" [value]="gender">{{ gender }}</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="submit" 
              class="btn-save" 
              [disabled]="editProfileForm.invalid || (isUpdating$ | async)">
              {{ (isUpdating$ | async) ? 'ÄŒuvanje...' : 'ğŸ’¾ SaÄuvaj' }}
            </button>
            <button 
              type="button" 
              class="btn-cancel" 
              (click)="cancelEdit()"
              [disabled]="isUpdating$ | async">
              âŒ OtkaÅ¾i
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Pacijenti Tab -->
    <div *ngIf="activeTab === 'pacijenti'" class="tab-content">
      <h3>Upravljanje Pacijentima</h3>
      
      <!-- PatientListComponent sa @Input i @Output -->
      <app-patient-list
        [patients]="(patients$ | async) || []"
        [loading]="(isLoadingUsers$ | async) || false"
        (deletePatient)="handleDeletePatient($event)"
        (editPatient)="handleEditPatient($event)">
      </app-patient-list>
    </div>

    <!-- Doktori Tab -->
    <div *ngIf="activeTab === 'doktori'" class="tab-content">
      <div class="tab-header">
        <h3>Upravljanje Doktorima</h3>
        <button class="btn-add-doctor" (click)="toggleAddDoctorForm()">
          {{ showAddDoctorForm ? 'âŒ Zatvori' : 'â• Dodaj Doktora' }}
        </button>
      </div>

      <!-- Add Doctor Form Component -->
      <app-add-doctor-form
        *ngIf="showAddDoctorForm"
        (submitForm)="handleSubmitDoctorForm($event)"
        (cancel)="handleCancelDoctorForm()">
      </app-add-doctor-form>

      <!-- Doctor List Component -->
      <app-doctor-list
        [doctors]="(doctors$ | async) || []"
        [loading]="(isLoadingUsers$ | async) || false"
        [expandedDoctorId]="expandedDoctorId"
        [selectedDoctorAction]="selectedDoctorAction"
        [selectedDoctorId]="selectedDoctorId"
        [doctorPatients]="doctorPatients"
        [loadingDoctorPatients]="loadingDoctorPatients"
        [doctorSchedules]="doctorSchedules"
        [loadingDoctorSchedules]="loadingDoctorSchedules"
        [selectedMonth]="selectedMonth"
        [scheduleSuccessMessage]="scheduleSuccessMessage"
        [scheduleErrorMessage]="scheduleErrorMessage"
        (deleteDoctor)="handleDeleteDoctor($event)"
        (editDoctor)="handleEditDoctor($event)"
        (toggleDetails)="toggleDoctorDetails($event)"
        (viewPatients)="viewDoctorPatients($event)"
        (addSchedule)="openAddScheduleForm($event)"
        (viewSchedule)="viewDoctorSchedule($event)"
        (submitSchedule)="handleSubmitSchedule($event)"
        (closeScheduleForm)="closeScheduleForm()"
        (monthChange)="onMonthChange($event)">
      </app-doctor-list>
    </div>

    <!-- Administratori Tab -->
    <div *ngIf="activeTab === 'administratori'" class="tab-content">
      <div class="tab-header">
        <h3>Upravljanje Administratorima</h3>
        <button class="btn-add-admin" (click)="toggleAddAdminForm()">
          {{ showAddAdminForm ? 'âŒ Zatvori' : 'â• Dodaj Administratora' }}
        </button>
      </div>

      <!-- TODO: Add Admin Form - will be implemented later -->
      <div *ngIf="showAddAdminForm" class="info-message">
        <p>Add Admin Form - To Be Implemented</p>
      </div>

      <!-- Admin List Component -->
      <app-admin-list
        [admins]="(admins$ | async) || []"
        [loading]="(isLoadingUsers$ | async) || false"
        (deleteAdmin)="handleDeleteAdmin($event)"
        (editAdmin)="handleEditAdmin($event)">
      </app-admin-list>
    </div>

    <!-- PoveÅ¾i Tab -->
    <div *ngIf="activeTab === 'povezi'" class="tab-content">
      <h3>ğŸ”— PoveÅ¾i doktora i pacijenta</h3>
      <p style="color: #64748b; margin-bottom: 2rem; text-align: center;">
        Izaberi pacijenta i doktora da bi ih povezao u sistem
      </p>
      
      <div class="assign-form">
        <!-- Pacijent Autocomplete -->
        <div class="form-group autocomplete-container">
          <label>ğŸ‘¤ Pacijent</label>
          
          <!-- Izabrani pacijent -->
          <div *ngIf="selectedPatient" class="selected-user">
            <div class="user-card">
              <div class="user-info">
                <strong>{{ selectedPatient.firstName }} {{ selectedPatient.lastName }}</strong>
                <span>{{ selectedPatient.email }}</span>
              </div>
              <button class="btn-clear" (click)="clearPatient()">âœ•</button>
            </div>
          </div>

          <!-- Search input -->
          <div *ngIf="!selectedPatient">
            <input 
              type="text" 
              class="form-control"
              placeholder="Kucaj ime, prezime ili email pacijenta..."
              (input)="onPatientSearchChange($any($event.target).value)"
            />
            
            <!-- Autocomplete dropdown -->
            <div class="autocomplete-dropdown" *ngIf="showPatientDropdown && (filteredPatients$ | async) as patients">
              <div 
                *ngFor="let patient of patients" 
                class="autocomplete-item"
                (mousedown)="selectPatient(patient)">
                <div class="user-icon">ğŸ‘¤</div>
                <div class="user-details">
                  <strong>{{ patient.firstName }} {{ patient.lastName }}</strong>
                  <span>{{ patient.email }}</span>
                </div>
              </div>
              <div *ngIf="patients.length === 0" class="no-results">
                Nema rezultata
              </div>
            </div>
          </div>
        </div>

        <!-- Doktor Autocomplete -->
        <div class="form-group autocomplete-container">
          <label>ğŸ‘¨â€âš•ï¸ Doktor</label>
          
          <!-- Izabrani doktor -->
          <div *ngIf="selectedDoctor" class="selected-user">
            <div class="user-card">
              <div class="user-info">
                <strong>Dr. {{ selectedDoctor.firstName }} {{ selectedDoctor.lastName }}</strong>
                <span>{{ selectedDoctor.email }}</span>
                <span class="specialization" *ngIf="selectedDoctor.specialization">
                  {{ selectedDoctor.specialization }}
                </span>
              </div>
              <button class="btn-clear" (click)="clearDoctor()">âœ•</button>
            </div>
          </div>

          <!-- Search input -->
          <div *ngIf="!selectedDoctor">
            <input 
              type="text" 
              class="form-control"
              placeholder="Kucaj ime, prezime ili email doktora..."
              (input)="onDoctorSearchChange($any($event.target).value)"
            />
            
            <!-- Autocomplete dropdown -->
            <div class="autocomplete-dropdown" *ngIf="showDoctorDropdown && (filteredDoctors$ | async) as doctors">
              <div 
                *ngFor="let doctor of doctors" 
                class="autocomplete-item"
                (mousedown)="selectDoctor(doctor)">
                <div class="user-icon">ğŸ‘¨â€âš•ï¸</div>
                <div class="user-details">
                  <strong>Dr. {{ doctor.firstName }} {{ doctor.lastName }}</strong>
                  <span>{{ doctor.email }}</span>
                  <span class="spec" *ngIf="doctor.specialization">{{ doctor.specialization }}</span>
                </div>
              </div>
              <div *ngIf="doctors.length === 0" class="no-results">
                Nema rezultata
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button 
            class="btn-assign"
            [disabled]="!selectedPatient || !selectedDoctor"
            (click)="assignDoctorToPatient()">
            ğŸ”— Dodeli doktora pacijentu
          </button>
        </div>
      </div>
    </div>

    <!-- Ukloni Tab -->
    <div *ngIf="activeTab === 'ukloni'" class="tab-content">
      <h3>âŒ Ukloni Pacijenta Doktoru</h3>
      <p style="color: #64748b; margin-bottom: 2rem; text-align: center;">
        Prvo izaberi doktora, pa onda pacijenta koji treba da se ukloni
      </p>
      
      <div class="assign-form">
        <!-- Doktor Autocomplete -->
        <div class="form-group autocomplete-container">
          <label>ğŸ‘¨â€âš•ï¸ Doktor</label>
          
          <!-- Izabrani doktor -->
          <div *ngIf="selectedRemoveDoctor" class="selected-user">
            <div class="user-card">
              <div class="user-info">
                <strong>Dr. {{ selectedRemoveDoctor.firstName }} {{ selectedRemoveDoctor.lastName }}</strong>
                <span>{{ selectedRemoveDoctor.email }}</span>
                <span class="specialization" *ngIf="selectedRemoveDoctor.specialization">
                  {{ selectedRemoveDoctor.specialization }}
                </span>
              </div>
              <button class="btn-clear" (click)="clearRemoveDoctor()">âœ•</button>
            </div>
          </div>

          <!-- Search input -->
          <div *ngIf="!selectedRemoveDoctor">
            <input 
              type="text" 
              class="form-control"
              placeholder="Kucaj ime, prezime ili email doktora..."
              (input)="onRemoveDoctorSearchChange($any($event.target).value)"
            />
            
            <!-- Autocomplete dropdown -->
            <div class="autocomplete-dropdown" *ngIf="showRemoveDoctorDropdown && (filteredRemoveDoctors$ | async) as doctors">
              <div 
                *ngFor="let doctor of doctors" 
                class="autocomplete-item"
                (mousedown)="selectRemoveDoctor(doctor)">
                <div class="user-icon">ğŸ‘¨â€âš•ï¸</div>
                <div class="user-details">
                  <strong>Dr. {{ doctor.firstName }} {{ doctor.lastName }}</strong>
                  <span>{{ doctor.email }}</span>
                  <span class="spec" *ngIf="doctor.specialization">{{ doctor.specialization }}</span>
                </div>
              </div>
              <div *ngIf="doctors.length === 0" class="no-results">
                Nema rezultata
              </div>
            </div>
          </div>
        </div>

        <!-- Pacijent Autocomplete - prikazuje se samo ako je doktor izabran -->
        <div class="form-group autocomplete-container" *ngIf="selectedRemoveDoctor">
          <label>ğŸ‘¤ Pacijent</label>
          
          <!-- Izabrani pacijent -->
          <div *ngIf="selectedRemovePatient" class="selected-user">
            <div class="user-card">
              <div class="user-info">
                <strong>{{ selectedRemovePatient.firstName }} {{ selectedRemovePatient.lastName }}</strong>
                <span>{{ selectedRemovePatient.email }}</span>
              </div>
              <button class="btn-clear" (click)="clearRemovePatient()">âœ•</button>
            </div>
          </div>

          <!-- Search input -->
          <div *ngIf="!selectedRemovePatient">
            <input 
              type="text" 
              class="form-control"
              placeholder="Kucaj ime, prezime ili email pacijenta..."
              (input)="onRemovePatientSearchChange($any($event.target).value)"
            />
            
            <!-- Autocomplete dropdown -->
            <div class="autocomplete-dropdown" *ngIf="showRemovePatientDropdown && (filteredRemovePatients$ | async) as patients">
              <div 
                *ngFor="let patient of patients" 
                class="autocomplete-item"
                (mousedown)="selectRemovePatient(patient)">
                <div class="user-icon">ğŸ‘¤</div>
                <div class="user-details">
                  <strong>{{ patient.firstName }} {{ patient.lastName }}</strong>
                  <span>{{ patient.email }}</span>
                </div>
              </div>
              <div *ngIf="patients.length === 0" class="no-results">
                Nema pacijenata za ovog doktora
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions" *ngIf="selectedRemoveDoctor">
          <button 
            class="btn-remove"
            [disabled]="!selectedRemovePatient || !selectedRemoveDoctor"
            (click)="removePatientFromDoctor()">
            âŒ Ukloni Pacijenta od Doktora
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal Component -->
  <app-edit-user-modal
    [user]="selectedUserForEdit"
    [show]="showEditModal"
    (save)="handleSaveUser($event)"
    (close)="handleCloseEditModal()">
  </app-edit-user-modal>
</div>
